name: $(BuildID)

resources:
  repositories:
  - repository: public
    type: github
    name: kipters/CrossNews
    endpoint: kipters

variables:
  buildConfiguration: 'Release'
  outputDirectory: '$(build.binariesDirectory)/$(buildConfiguration)'
  solution: 'CrossNews.sln'

trigger:
  - master

jobs:
- job: android
  displayName: Android build
  continueOnError: true
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - task: NuGetToolInstaller@0
    displayName: 'Use NuGet 4.4.1'
    inputs:
      versionSpec: 4.4.1
  
  - task: NugetCommand@2
    displayName: 'NuGet restore'
    inputs:
      restoreSolution: $(solution)

  - task: XamariniOS@2
    displayName: 'Build iOS app'
    inputs:
      solutionFile: $(solution)
      configuration: $(buildconfiguration) 
      packageApp: false
      buildForSimulator: true
      #signingIdentity: # Optional
      #signingProvisioningProfileID: # Optional

  - task: CopyFiles@2
    displayName: 'Copy files to staging directory'
    inputs:
      sourceFolder: $(outputDirectory)
      contents: '**/*.ipa'
      targetFolder: '$(build.artifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Build Artifacts'
